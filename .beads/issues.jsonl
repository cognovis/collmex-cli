{"id":"collmex-cli-9e8","title":"ZUGFeRD Invoice Processing Workflow","description":"## Ziel\nAutomatisierte Verarbeitung von Lieferantenrechnungen mit LLM-Analyse und ZUGFeRD-Export.\n\n## Entscheidungen\n- **Python-Bibliothek:** python-drafthorse (ZUGFeRD 2.3, low-level)\n- **SMTP-Config:** Via Umgebungsvariablen (COLLMEX_SMTP_*)\n- **Käufer-Daten:** In Config (COLLMEX_BUYER_*)\n- **BuyerTradeParty ID:** Eigene Kundennr beim Lieferanten (falls bekannt)\n- **Lieferanten-Matching:** IBAN \u003e USt-IdNr \u003e Firmenname (fuzzy)\n\n## Architektur\n**CLI (strukturiert, wiederholbar):**\n- vendors --search / vendor-create (existiert)\n- vendor-match --iban/--vat/--name (NEU)\n- zugferd-create (NEU)\n- invoice-send (NEU, SMTP)\n- unbooked (NEU, Bankbewegungen ohne Zuordnung)\n\n**LLM/Claude (Analyse, Entscheidungen):**\n- PDF analysieren → strukturierte Daten extrahieren\n- Lieferant matchen (CLI aufrufen)\n- Bei Unklarheit: User fragen\n- Workflow orchestrieren\n\n## API-Einschränkung\nKEIN Endpunkt für 'Zu buchen' Kontoumsätze. \nWorkaround: ACCDOC_GET auf Bankkonto, filtern nach fehlender Zuordnung.\n\n## Config-Erweiterung\n```\nCOLLMEX_SMTP_HOST=smtp.example.com\nCOLLMEX_SMTP_PORT=587\nCOLLMEX_SMTP_USER=...\nCOLLMEX_SMTP_PASSWORD=...\nCOLLMEX_SMTP_FROM=buchhaltung@cognovis.de\nCOLLMEX_ACCOUNTING_EMAIL=buchhaltung@cognovis.de\n\nCOLLMEX_BUYER_NAME=cognovis GmbH\nCOLLMEX_BUYER_STREET=Schrödersweg 27\nCOLLMEX_BUYER_ZIP=22453\nCOLLMEX_BUYER_CITY=Hamburg\nCOLLMEX_BUYER_COUNTRY=DE\nCOLLMEX_BUYER_VAT_ID=DE...\nCOLLMEX_BUYER_EMAIL=buchhaltung@cognovis.de\n```","notes":"## Recherche-Ergebnis\n\n### XML-Format (UN/CEFACT CII)\nCollmex verwendet UN/CEFACT CrossIndustryInvoice (CII) nach EN 16931.\n\n### API-Einschränkung\nKEIN API-Endpunkt für Zu-buchen Kontoumsätze! Workaround: ACCDOC_GET auf Bankkonto.\n\n### Architektur\nCLI: vendors, zugferd-generate, send-invoice / LLM: PDF analysieren, Lieferant matchen","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:00:26.613949+01:00","created_by":"malte","updated_at":"2026-01-06T16:01:58.067707+01:00","closed_at":"2026-01-06T16:01:58.067707+01:00","close_reason":"All components implemented: vendor-match, zugferd-create, invoice-send, unmatched, config extensions"}
{"id":"collmex-cli-9e8.1","title":"vendor-match command","description":"Neuer CLI-Befehl zum Matchen/Anlegen von Lieferanten.\n\n## Verwendung\n```bash\ncollmex vendor-match --iban DE89... --vat DE123... --name 'Amazon'\n```\n\n## Logik\n1. Suche nach IBAN (exakt) → 100% Match\n2. Suche nach USt-IdNr (exakt) → 100% Match\n3. Suche nach Name (fuzzy) → Vorschläge ausgeben\n4. Kein Match → Option zum Anlegen\n\n## Output (JSON)\n```json\n{\"match\": \"exact\", \"vendor_id\": 72105, \"vendor_name\": \"Amazon\"}\n{\"match\": \"fuzzy\", \"candidates\": [{\"vendor_id\": 123, \"name\": \"Amazon EU\", \"score\": 0.9}]}\n{\"match\": \"none\", \"created\": true, \"vendor_id\": 72106}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:23:15.938747+01:00","created_by":"malte","updated_at":"2026-01-06T15:57:42.364699+01:00","closed_at":"2026-01-06T15:57:42.364702+01:00","dependencies":[{"issue_id":"collmex-cli-9e8.1","depends_on_id":"collmex-cli-9e8","type":"parent-child","created_at":"2026-01-06T15:23:15.940511+01:00","created_by":"malte"}]}
{"id":"collmex-cli-9e8.2","title":"zugferd-create command","description":"Neuer CLI-Befehl zum Generieren von ZUGFeRD XML.\n\n## Abhängigkeit\n- python-drafthorse Bibliothek\n\n## Verwendung\n```bash\ncollmex zugferd-create \\\n  --vendor-id 72105 \\\n  --invoice-number 'INV-2024-001' \\\n  --invoice-date 2024-12-15 \\\n  --net-amount 100.00 \\\n  --tax-rate 19 \\\n  --description 'Hosting Services' \\\n  --output invoice.xml\n```\n\n## Datenquellen\n- Lieferantendaten: Aus Collmex via vendor-id abrufen\n- Käuferdaten: Aus Config (COLLMEX_BUYER_*)\n- Rechnungsdaten: CLI-Parameter\n\n## Output\n- ZUGFeRD 2.3 XML (UN/CEFACT CII, EN 16931 konform)\n- Optional: PDF mit eingebettetem XML","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:23:28.82514+01:00","created_by":"malte","updated_at":"2026-01-06T16:00:34.572677+01:00","closed_at":"2026-01-06T16:00:34.572677+01:00","close_reason":"zugferd-create CLI command implemented with python-drafthorse","dependencies":[{"issue_id":"collmex-cli-9e8.2","depends_on_id":"collmex-cli-9e8","type":"parent-child","created_at":"2026-01-06T15:23:28.827271+01:00","created_by":"malte"}]}
{"id":"collmex-cli-9e8.3","title":"invoice-send command","description":"Neuer CLI-Befehl zum Versenden von Rechnungen per SMTP.\n\n## Verwendung\n```bash\ncollmex invoice-send \\\n  --pdf rechnung.pdf \\\n  --xml rechnung.xml \\\n  --subject 'Lieferantenrechnung Amazon INV-2024-001'\n```\n\n## Config (Umgebungsvariablen)\n- COLLMEX_SMTP_HOST\n- COLLMEX_SMTP_PORT (default: 587)\n- COLLMEX_SMTP_USER\n- COLLMEX_SMTP_PASSWORD\n- COLLMEX_SMTP_FROM\n- COLLMEX_ACCOUNTING_EMAIL (Empfänger)\n\n## Verhalten\n- Sendet E-Mail mit PDF und XML als Attachments\n- An COLLMEX_ACCOUNTING_EMAIL\n- Collmex liest per IMAP und importiert automatisch","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:23:38.096646+01:00","created_by":"malte","updated_at":"2026-01-06T16:01:20.470824+01:00","closed_at":"2026-01-06T16:01:20.470824+01:00","close_reason":"invoice-send CLI command implemented with SMTP support","dependencies":[{"issue_id":"collmex-cli-9e8.3","depends_on_id":"collmex-cli-9e8","type":"parent-child","created_at":"2026-01-06T15:23:38.0986+01:00","created_by":"malte"}]}
{"id":"collmex-cli-9e8.4","title":"unbooked command","description":"Neuer CLI-Befehl für ungebuchte Bankbewegungen.\n\n## Problem\nKeine direkte API für 'Zu buchen' Status.\n\n## Workaround\nACCDOC_GET auf Bankkonto (z.B. 1200), dann filtern:\n- Buchungen ohne Lieferanten-Zuordnung (vendor_id = null)\n- Buchungen ohne Kunden-Zuordnung (customer_id = null)\n- Buchungen ohne Rechnungsnummer\n\n## Verwendung\n```bash\ncollmex unbooked --account 1200 --from 2024-01-01\n```\n\n## Output (JSON)\n```json\n[\n  {\n    \"booking_id\": 12345,\n    \"date\": \"2024-12-15\",\n    \"amount\": -100.00,\n    \"text\": \"Amazon Web Services\",\n    \"needs_receipt\": true\n  }\n]\n```\n\n## Hinweis\nErsetzt/erweitert den existierenden 'unmatched' Befehl","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:23:49.302539+01:00","created_by":"malte","updated_at":"2026-01-06T16:01:36.802504+01:00","closed_at":"2026-01-06T16:01:36.802504+01:00","close_reason":"Already implemented as 'unmatched' command - filters bank account bookings without vendor/customer/invoice assignment","dependencies":[{"issue_id":"collmex-cli-9e8.4","depends_on_id":"collmex-cli-9e8","type":"parent-child","created_at":"2026-01-06T15:23:49.304383+01:00","created_by":"malte"}]}
{"id":"collmex-cli-9e8.5","title":"Config erweitern (SMTP, Buyer)","description":"Erweitere CollmexConfig um SMTP und Buyer-Daten.\n\n## Neue Config-Felder\n\n### SMTP\n```python\nsmtp_host: str | None\nsmtp_port: int = 587\nsmtp_user: str | None\nsmtp_password: str | None\nsmtp_from: str | None\naccounting_email: str | None\n```\n\n### Buyer (eigene Firma)\n```python\nbuyer_name: str | None\nbuyer_street: str | None\nbuyer_zip: str | None\nbuyer_city: str | None\nbuyer_country: str = 'DE'\nbuyer_vat_id: str | None\nbuyer_email: str | None\n```\n\n## Umgebungsvariablen\nCOLLMEX_SMTP_HOST, COLLMEX_SMTP_PORT, etc.\nCOLLMEX_BUYER_NAME, COLLMEX_BUYER_STREET, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T15:23:58.002115+01:00","created_by":"malte","updated_at":"2026-01-06T15:56:25.403597+01:00","closed_at":"2026-01-06T15:56:25.403599+01:00","dependencies":[{"issue_id":"collmex-cli-9e8.5","depends_on_id":"collmex-cli-9e8","type":"parent-child","created_at":"2026-01-06T15:23:58.004163+01:00","created_by":"malte"}]}
